<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - Breda Roleplay</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .login-card {
            background: white;
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            text-align: left;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .debug-info h4 {
            margin-top: 0;
            color: #1a237e;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div style="font-size: 3rem; color: #1a237e; margin-bottom: 1rem;">
                <i class="fas fa-user-shield"></i>
            </div>
            <h1>Admin Login</h1>
            <p>Breda The Netherlands Roleplay Admin Panel</p>
            
            <div id="netlify-identity-container">
                <button onclick="login()" style="background: #1a237e; color: white; border: none; padding: 12px 24px; border-radius: 5px; font-size: 1rem; cursor: pointer; margin: 1rem 0;">
                    <i class="fas fa-sign-in-alt"></i> Open Login
                </button>
            </div>
            
            <div class="debug-info">
                <h4>Debug Info:</h4>
                <div id="debug-log">
                    Loading...
                </div>
            </div>
            
            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #eee; font-size: 0.9rem; color: #777;">
                <p><strong>Problemen?</strong> Clear je browser cache (F12 → Application → Clear Storage)</p>
            </div>
            
            <a href="/" style="display: inline-block; margin-top: 1rem; color: #1a237e; text-decoration: none;">
                <i class="fas fa-arrow-left"></i> Terug naar website
            </a>
        </div>
    </div>
    
    <script>
        let debugLog = document.getElementById('debug-log');
        
        function log(message) {
            debugLog.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
            console.log(message);
        }
        
        function login() {
            log('Opening Netlify Identity modal...');
            if (window.netlifyIdentity) {
                netlifyIdentity.open('login');
            } else {
                log('ERROR: netlifyIdentity not loaded');
            }
        }
        
        // Netlify Identity event handlers
        if (window.netlifyIdentity) {
            log('Netlify Identity loaded');
            
            netlifyIdentity.on('init', user => {
                log(`Identity initialized. User: ${user ? 'Logged in' : 'Not logged in'}`);
                if (user) {
                    log(`User email: ${user.email}`);
                    log('Redirecting to dashboard...');
                    setTimeout(() => {
                        window.location.href = '/admin/dashboard.html';
                    }, 1000);
                }
            });
            
            netlifyIdentity.on('login', user => {
                log(`Login successful: ${user.email}`);
                log('User token: ' + (user.token ? 'Present' : 'Missing'));
                log('Redirecting in 2 seconds...');
                setTimeout(() => {
                    window.location.href = '/admin/dashboard.html';
                }, 2000);
            });
            
            netlifyIdentity.on('logout', () => {
                log('User logged out');
            });
            
            netlifyIdentity.on('error', err => {
                log(`Identity error: ${err.message || err}`);
            });
            
            // Initialize
            log('Initializing Netlify Identity...');
            netlifyIdentity.init();
            
        } else {
            log('ERROR: Netlify Identity widget script not loaded properly');
            log('Check: https://identity.netlify.com/v1/netlify-identity-widget.js');
        }
        
        // Test Identity endpoint
        fetch('https://bredathenetherlands.netlify.app/.netlify/identity')
            .then(response => {
                log(`Identity endpoint status: ${response.status}`);
                return response.text();
            })
            .then(text => {
                if (text.includes('gotrue')) {
                    log('Identity endpoint: OK');
                } else {
                    log('Identity endpoint: Unexpected response');
                }
            })
            .catch(error => {
                log(`Identity endpoint error: ${error.message}`);
            });
    </script>
</body>
</html>
